#线程安全性
- 当多个线程访问同一个可变的状态变量时没有使用合适的同步，那么程序就会出现错误，有三种方式可以修复该问题：不在程序之间共享该状态变量、将状态变量修改为不可变的变量、在访问状态变量时使用同步
P13 什么是线程安全
##什么是线程安全性
- 当多个线程访问某个类时，不管运行时环境采用何种调度方式或者这些线程将如何交替执行，并且在主调代码中不需要任何额外的同步或协同，这个类都能表现出正确的行为，那么称这个类是线程安全的。
- 无状态对象一定是线程安全的
###竞态条件
###实例：延迟初始化中的竟态条件
###复合操作
- 原子操作是指对于访问同一个状态的所有操作（包括操作本身）来说，这个操作是一个以原子方式执行的操作。
- 我们将先检查后执行以及读取-修改-写入等操作统称为符合操作：包含了一组必须以原子方式执行的操作以确保线程安全性
- java.util.concurrent.atomic包中包含了一些原子变量类，用于实现在数值和对象引用上的原子状态转换，如：用AtomicLong代替Long
##加锁机制


##加锁机制
- 要保持状态的一致性，就需要在单个原子操作中更新所有相关的状态变量
###内置锁
- Java提供一种内置的锁机制来支持原子性：同步代码块
- Java的内置锁相当于互斥锁
###重入
##用锁来保护状态
- 对于可能被多个线程同时访问的可变状态变量，在访问它时都需要持有同一个锁，在这种情况下，我们称状态变量是由这个锁保护的
- 每个共享的和可变的变量都应该只由一个锁来保护，从而使维护人员知道是哪一个锁
- 一种常见加锁约定是，将所有的可变状态都封装在对象内部，并通过对象的内置锁对所有访问可变状态的代码路径进行同步。
- 对于每个包含多个变量的不变性条件，其中涉及到的所有变量都需要由同一个锁来保护
##活跃性与性能

